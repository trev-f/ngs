manifest {
    author            = 'Trevor F. Freeman; Ryan D. Kuster'
    defaultBranch     = 'main'
    recurseSubmodules = true
    description       = 'A flexible pipeline for RNA-Seq.'
    mainScript        = 'main.nf'
    name              = 'trev-f/utia_rnaseq'
    nextflowVersion   = '>=21.04'
    version           = 'v0.0.1'
}

params {
    /*
    ---------------------------------------------------------------------
        Project parameters
    ---------------------------------------------------------------------
    */
    project_title = "campus_test5"

   /*
    ---------------------------------------------------------------------
        Reads QC parameters
    ---------------------------------------------------------------------
    */

    skipRawFastQC        = false

    /*
    ---------------------------------------------------------------------
        Read-trimming parameters
    ---------------------------------------------------------------------
    */

    trimTool             = "cutadapt"
    r1_adapter           = "AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT"
    r2_adapter           = "AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC"
    minimum_length       = 30
    skipTrimReads        = false
    skipTrimFastQC       = false

    /*
    ---------------------------------------------------------------------
        Alignment parameters
    ---------------------------------------------------------------------
    */

    alignmentTool        = 'star'
    sjdbOverhang         = 99
    skipAlignmentStatsQC = false
}


profiles {
    isaac {
        includeConfig "conf/qos.config"
        workDir = "${SCRATCHDIR}/${params.project_title}/work/"

        /*
        ---------------------------------------------------------------------
            System settings
        ---------------------------------------------------------------------
        */
        
        executor {
            queueSize = 50
            submitRateLimit = '10/1min'
        }

        singularity {
            enabled = true
            cacheDir = "/nfs/home/${USER}/singularity/"
            autoMounts = true
        }

        process {
            publish_dir = "${SCRATCHDIR}/${params.project_title}/publish/"
            executor = 'slurm'
        }


        /*
        ---------------------------------------------------------------------
            Reporting
        ---------------------------------------------------------------------
        */
        
        timestamp = new java.util.Date().format('yyyy-MM-dd_HH-mm')
        
        dag {
            enabled = true
            file    = "${process.publish_dir}/summary/${timestamp}_dag.html"
        }
        
        report {
            enabled = true
            file    = "${process.publish_dir}/summary/${timestamp}_report.html"
        }
        
        timeline{
            enabled = true
            file    = "${process.publish_dir}/summary/${timestamp}_timeline.html"
        }
        
        trace {
            enabled = true
            file    = "${process.publish_dir}/summary/${timestamp}_trace.html"
        }

    }

    nf_test {
        params.input = "https://github.com/trev-f/SRAlign-test/raw/rnaseq/samplesheets/samplesheet_mix.csv"
        params.ref   = "https://github.com/trev-f/SRAlign-test/raw/rnaseq/data/references/R64-1-1/genome_I.fa.gz"
        params.annot = "https://github.com/trev-f/SRAlign-test/raw/rnaseq/data/references/R64-1-1/annotations_I.gtf.gz"
        
        singularity {
            enabled = true
            cacheDir = "${SCRATCHDIR}/singularity/"
            autoMounts = true
        }
    }
}

/*
---------------------------------------------------------------------
    Import config files
---------------------------------------------------------------------
*/
includeConfig "conf/containers.config"
